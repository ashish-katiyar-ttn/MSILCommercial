@using Sitecore.Mvc
@using Sitecore.Mvc.Presentation
@using MSIL.Models
@model List<State>
<div class="container-xxl py-5">
    <div class="container">
        <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
            <h6 class="section-title text-center text-primary text-uppercase">FIND A DEALER</h6>
            <h1 class="mb-5"><span class="text-primary text-uppercase">Search</span> A Dealer</h1>
        </div>
        <div class="row g-4">
            <div class="col-md-12">
                <div class="wow fadeInUp" data-wow-delay="0.2s">
            
                        <div class="row g-3">
                            <div class="col-4">
                                <div class="form-floating">
                                    <select name="State" id="State" class="form-control">
                                        <option value="0">--Select--</option>
                                        @if (Model != null && Model.Count > 0)
                                        {
                                            foreach (State state in Model)
                                            {
                                                <option value="@state.Id">@state.Name</option>
                                            }
                                        }
                                    </select>
                                    <label for="State">State</label>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="form-floating">
                                    <div class="form-floating">
                                        <select name="City" id="City" class="form-control">
                                            <option value="0">--Select--</option>
                                        </select>
                                        <label for="City">City</label>
                                    </div>
                                </div>

                            </div>
                            <div class="col-2">
                                <button id="btnSearch" class="btn btn-primary w-100 py-3">Search</button>
                            </div>

                </div>
            </div>
            <div class="row g-4" id="con"style="margin-top: 1px; margin-bottom: 23px;">

            </div>
            <div class="col-md-12 wow fadeIn" data-wow-delay="0.1s">
                <iframe class="position-relative rounded w-100 h-100"
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3001156.4288297426!2d-78.01371936852176!3d42.72876761954724!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x4ccc4bf0f123a5a9%3A0xddcfc6c1de189567!2sNew%20York%2C%20USA!5e0!3m2!1sen!2sbd!4v1603794290143!5m2!1sen!2sbd"
                        frameborder="0" style="min-height: 650px; border:0;" allowfullscreen="" aria-hidden="false"
                        tabindex="0"></iframe>
            </div>

        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.js" integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous"></script>

<script type="text/javascript">
    $(document).ready(function () {
        $("#State").on('change', function () {    // 2nd way
            var Id = $("#State").val();
            if (Id != "") {
                $.ajax({
                    url: "http://msilcommercial.local:82/api/sitecore/FindADelear/GetCitylist",
                    type: "GET",
                    data: { stateId: Id },
                    context: this,
                    success: function (data) {
                        var mySelect = $('#City');
                        $.each(data, function (val, text) {
                            mySelect.append(

                                $('<option></option>').val(text.Id).html(text.Name)
                            );
                        });
                    },
                    error: function (data) {
                        console.log("error", data);
                    }
                });
            }
            else {
            }

        });
        $("#btnSearch").on('click', function () {   
            var Id = $("#City").val();
            if (Id != "") {
                $.ajax({
                    url: "http://msilcommercial.local:82/api/sitecore/FindADelear/GetDealers",
                    type: "GET",
                    data: { cityId: Id },
                    context: this,
                    success: function (data) {
                        var mySelect = $('#con');
                        $.each(data, function (val, text) {
                            var html = '<div class="col-lg-3 col-md-6 wow fadeInUp" data-wow-delay="0.1s"><div class="rounded shadow overflow-hidden" ><div class="text-center p-4 mt-3"><h5 class="fw-bold mb-0"><i class="fa fa-envelope me-3"></i>'+text.Name+'</h5><small><i class="fa fa-map-marker me-3"></i>'+text.Address+'</small><br /><small><i class="fa fa-phone me-3"></i>'+text.Contacts+'</small></div></div></div>';
                            mySelect.append(html);
                        });
                    },
                    error: function (data) {
                        console.log("error", data);
                    }
                });
            }
            else {
            }

        });


        });
</script>

